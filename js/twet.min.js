/*!
 *
 * Twet.js
 * A simple jQuery plugin for adding Twitter streams to your website
 * Author: Derek Wheelden
 * Version: 1.1.0
 * Requires: jQuery 1.6+
 * Copyright (c) 2012, Derek Wheelden (derek[dot]wheelden[at]gmail[dot]com)
 */(function(a,b,c,d){"use strict";a.fn.twetJs=function(b){var c={$element:this,query:"#twitter",limit:15,refreshTweets:!0,refreshRate:3e4,titleBadge:!0,blacklist:[]};typeof b=="object"?c=a.extend(c,b):typeof b=="string"&&(c=a.extend(c,{query:b}));var d={buildFeedUrl:function(a,b){var d=c.query.replace("#","%23").replace("@","%40");return a?"http://search.twitter.com/search.json"+b:"http://search.twitter.com/search.json?q="+d+"&rpp="+c.limit+"&include_entities=t"},buildNewTweetsBadge:function(b){a("<a/>",{id:"newTwets",href:"#",css:{display:"none"},text:b+" new tweets"}).prependTo(c.$element).slideDown("slow")},buildTimeStamp:function(a){var b=new Date,c=b.getTimezoneOffset()/60,d=a.substr(12,4),e=a.substr(5,2),f=a.substr(17,2)-c,g=a.substr(20,2),h=a.substr(23,2),i=a.substr(8,3);return i+" "+e+", "+d+" @ "+f+":"+g+":"+h},buildRelativeTime:function(a){var b,c,d=6e4,e=d*60,f=e*24,g=f*30,h=f*365,i=new Date,j=i.getTimezoneOffset()/60,k=a.substr(12,4),l=a.substr(0,3),m=a.substr(5,2),n=a.substr(17,2)-j,o=a.substr(20,2),p=a.substr(23,2),q=a.substr(8,3),r={Jan:"01",Feb:"02",Mar:"03",Apr:"04",May:"05",Jun:"06",Jul:"07",Aug:"08",Sep:"09",Oct:"10",Nov:"11",Dec:"12"},s=r[q]-1,t=new Date(k,s,m,n,o,p,999),u=i-t;if(u<d)return Math.round(u/1e3)+" seconds ago";if(u<e){b=Math.round(u/d);c=b===1?"minute":"minutes";return b+" "+c+" ago"}if(u<f){b=Math.round(u/e);c=b===1?"hour":"hours";return b+" "+c+" ago"}if(u<g){b=Math.round(u/f);c=b===1?"day":"days";return b+" "+c+" ago"}if(u<h){b=Math.round(u/g);c=b===1?"month":"months";return b+" "+c+" ago"}b=Math.round(u/h);c=b===1?"year":"years";return b+" "+c+" ago"},parseTweet:function(b,c){var d,e,f,g;a(c.user_mentions).each(function(a){d=this.screen_name;b=b.replace("@"+d,'<a href="https://twitter.com/#!/'+d+'">@'+d+"</a>")});a(c.hashtags).each(function(a){e=this.text;b=b.replace("#"+e,'<a href="https://twitter.com/#!/search/%23'+e+'">#'+e+"</a>")});a(c.urls).each(function(a){f=this.url;g=this.display_url;b=b.replace(f,'<a href="'+f+'">'+g+"</a>")});return b}};String.prototype.parseURL=function(){return this.replace(/[A-Za-z]+:\/\/[A-Za-z0-9-_]+\.[A-Za-z0-9-_:%&~\?\/.=]+/g,function(a){return'<a href="'+a+'" target="_blank">'+a+"</a>"})};String.prototype.parseUsername=function(){return this.replace(/[@]+[A-Za-z0-9-_]+/g,function(a){var b=a.replace("@","");return a.link("http://twitter.com/"+b)})};String.prototype.parseHashtag=function(){return this.replace(/[#]+[A-Za-z0-9-_]+/g,function(a){var b=a.replace("#","%23");return'<a href="http://search.twitter.com/search?q='+b+'" target="_blank">'+a+"</a>"})};return this.each(function(){(function b(e){a.ajax({type:"GET",url:e||d.buildFeedUrl(),dataType:"jsonp",success:function(e){if(!e.results.length){a("<div/>",{id:"twetError",css:{display:"none"},text:"Woops! We couldn't find any tweets!"}).prependTo(c.$element).fadeIn("slow");return!1}var f=e.results,g=e.refresh_url,h=1;a("<div/>",{"class":"twetGroupWrapper"}).prependTo(c.$element);var i=a(c.$element).find(".twetGroupWrapper").first();a(f).each(function(){var b={timestamp:this.created_at,username:this.from_user,avatarUrl:this.profile_image_url,tweetId:this.id_str,tweetText:this.text,entities:this.entities,mention:this.to_user};if(a.inArray(b.username,c.blacklist)>-1)return!0;var e=d.buildTimeStamp(b.timestamp),f=d.buildRelativeTime(b.timestamp),g=d.parseTweet(b.tweetText,b.entities),j='<a href="https://twitter.com/#!/'+b.username+"/status/"+b.tweetId+'" title="'+e+'">'+f+"</a> from @"+b.username,k=j.parseUsername();a("<div/>",{"class":"twet clearfix",html:'<img src="'+b.avatarUrl+'" alt="'+b.username+'" /><div>'+g+"<br /><small>"+k+"</small></div></div>"}).appendTo(i);if(h===c.limit)return!1;h++});c.refreshTweets&&function j(){var e=d.buildFeedUrl(!0,g);setTimeout(function(){a.ajax({type:"GET",url:e,dataType:"jsonp",success:function(f){var g=f.results,h=g.length;if(!g.length)j();else{d.buildNewTweetsBadge(h);if(c.titleBadge){var i=a("title"),k=i.text();i.text("("+h+") "+k)}a("#newTwets").click(function(c){c.preventDefault();i&&i.text(k);a(this).slideUp("slow",function(){a(this).remove();b(e)})});clearTimeout()}}})},c.refreshRate)}()},error:function(a,b,c){},complete:function(a,b){b!=="success"}})})()})}})(jQuery,window,document);