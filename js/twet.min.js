/*!
 *
 * Twet.js
 * A simple jQuery plugin for adding Twitter streams to your website
 * Author: Derek Wheelden
 * Version: 1.2
 * Requires: jQuery 1.6+
 * Copyright (c) 2012, Derek Wheelden (derek[dot]wheelden[at]gmail[dot]com)
 */(function(e,t,n,r){"use strict";e.fn.twetJs=function(t){var n={$element:this,query:"#twitter",limit:1,refreshTweets:!0,refreshRate:3e4,titleBadge:!0,blacklist:[]};typeof t=="object"?n=e.extend(n,t):typeof t=="string"&&(n=e.extend(n,{query:t}));var r={buildFeedUrl:function(e,t){var r=n.query.replace("#","%23").replace("@","%40");return e?"http://search.twitter.com/search.json"+t:"http://search.twitter.com/search.json?q="+r+"&rpp="+n.limit+"&include_entities=t"},buildNewTweetsBadge:function(t){e("<a/>",{id:"newTwets",href:"#",css:{display:"none"},text:t+" new tweets"}).prependTo(n.$element).slideDown("slow")},buildTimeStamp:function(e){var t=new Date,n=t.getTimezoneOffset()/60,r=e.substr(12,4),i=e.substr(5,2),s=e.substr(17,2)-n,o=e.substr(20,2),u=e.substr(23,2),a=e.substr(8,3);return a+" "+i+", "+r+" @ "+s+":"+o+":"+u},buildRelativeTime:function(e){var t,n,r=6e4,i=r*60,s=i*24,o=s*30,u=s*365,a=new Date,f=a.getTimezoneOffset()/60,l=e.substr(12,4),c=e.substr(0,3),h=e.substr(5,2),p=e.substr(17,2)-f,d=e.substr(20,2),v=e.substr(23,2),m=e.substr(8,3),g={Jan:"01",Feb:"02",Mar:"03",Apr:"04",May:"05",Jun:"06",Jul:"07",Aug:"08",Sep:"09",Oct:"10",Nov:"11",Dec:"12"},y=g[m]-1,b=new Date(l,y,h,p,d,v,999),w=a-b;if(w<r)return Math.round(w/1e3)+" seconds ago";if(w<i){t=Math.round(w/r);n=t===1?"minute":"minutes";return t+" "+n+" ago"}if(w<s){t=Math.round(w/i);n=t===1?"hour":"hours";return t+" "+n+" ago"}if(w<o){t=Math.round(w/s);n=t===1?"day":"days";return t+" "+n+" ago"}if(w<u){t=Math.round(w/o);n=t===1?"month":"months";return t+" "+n+" ago"}t=Math.round(w/u);n=t===1?"year":"years";return t+" "+n+" ago"},parseTweet:function(t,n){var r,i,s,o,u,a="https://twitter.com/#!/";e(n.user_mentions).each(function(e){r=this.screen_name;t=t.replace("@"+r,'<a href="'+a+r+'" title="@'+r+'">@'+r+"</a>")});e(n.hashtags).each(function(e){i=this.text;t=t.replace("#"+i,'<a href="'+a+"search/%23"+i+'" title="#'+i+'">#'+i+"</a>")});e(n.urls).each(function(e){s=this.url;o=this.display_url;u=this.expanded_url;t=t.replace(s,'<a href="'+s+'" title="'+u+'">'+o+"</a>")});return t}};String.prototype.parseURL=function(){return this.replace(/[A-Za-z]+:\/\/[A-Za-z0-9-_]+\.[A-Za-z0-9-_:%&~\?\/.=]+/g,function(e){return'<a href="'+e+'" target="_blank">'+e+"</a>"})};String.prototype.parseUsername=function(){return this.replace(/[@]+[A-Za-z0-9-_]+/g,function(e){var t=e.replace("@","");return e.link("http://twitter.com/"+t)})};String.prototype.parseHashtag=function(){return this.replace(/[#]+[A-Za-z0-9-_]+/g,function(e){var t=e.replace("#","%23");return'<a href="http://search.twitter.com/search?q='+t+'" target="_blank">'+e+"</a>"})};return this.each(function(){(function t(i){e.ajax({type:"GET",url:i||r.buildFeedUrl(),dataType:"jsonp",success:function(i){if(!i.results.length){e("<div/>",{id:"twetError",css:{display:"none"},text:"Woops! We couldn't find any tweets!"}).prependTo(n.$element).fadeIn("slow");return!1}var s=i.results,o=i.refresh_url,u=1;e("<div/>",{"class":"twetGroupWrapper"}).prependTo(n.$element);var a=e(n.$element).find(".twetGroupWrapper").first();e(s).each(function(){var t={timestamp:this.created_at,username:this.from_user,avatarUrl:this.profile_image_url,tweetId:this.id_str,tweetText:this.text,entities:this.entities,mention:this.to_user};if(e.inArray(t.username,n.blacklist)>-1)return!0;var i=r.buildTimeStamp(t.timestamp),s=r.buildRelativeTime(t.timestamp),o=r.parseTweet(t.tweetText,t.entities),f='<a href="https://twitter.com/#!/'+t.username+"/status/"+t.tweetId+'" title="'+i+'">'+s+"</a> from @"+t.username,l=f.parseUsername();e("<div/>",{"class":"twet clearfix",html:'<img src="'+t.avatarUrl+'" alt="'+t.username+'" class="twetAvatar" /><div class="twetText">'+o+'<br /><div class="twetDetails">'+l+"</div></div></div>"}).appendTo(a);if(u===n.limit)return!1;u++});n.refreshTweets&&function f(){var i=r.buildFeedUrl(!0,o);setTimeout(function(){e.ajax({type:"GET",url:i,dataType:"jsonp",success:function(s){var o=s.results,u=o.length;if(!o.length)f();else{r.buildNewTweetsBadge(u);if(n.titleBadge){var a=e("title"),l=a.text();a.text("("+u+") "+l)}e("#newTwets").click(function(n){n.preventDefault();a&&a.text(l);e(this).slideUp("slow",function(){e(this).remove();t(i)})});clearTimeout()}}})},n.refreshRate)}()},error:function(e,t,n){},complete:function(e,t){t==="success"}})})()})}})(jQuery,window,document);